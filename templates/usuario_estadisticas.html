<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Estad칤sticas</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- CSS GLOBAL -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/usuario.css') }}">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

<!-- HEADER -->
<header>
    <h2>游늵 Estad칤sticas</h2>

    <nav class="user-nav">
        <a href="{{ url_for('usuario_panel') }}">游늶 Mis tareas</a>
        <a href="{{ url_for('usuario_calendario') }}">游늰 Calendario</a>
        <a href="{{ url_for('usuario_estadisticas') }}">游늵 Estad칤sticas</a>
    </nav>

    <div class="header-actions">
        <span class="user-badge">{{ session.usuario }}</span>
        <a href="{{ url_for('logout') }}">Cerrar sesi칩n</a>
    </div>
</header>

<!-- MAIN -->
<main class="user-dashboard">

    <h3 class="section-title">Resumen general</h3>

    <!-- RESUMEN -->
    <div class="resumen-usuario compacto">

        <div class="task-card">
            <span>Total tareas</span>
            <h2>{{ total }}</h2>
        </div>

        <div class="task-card">
            <span>Completadas</span>
            <h2 style="color:#34c759;">{{ completadas }}</h2>
        </div>

        <div class="task-card">
            <span>Pendientes</span>
            <h2 style="color:#ff3b30;">{{ pendientes }}</h2>
        </div>

    </div>

    <h3 class="section-title">Gr치ficas</h3>

    <!-- GR츼FICAS -->
    <div class="tareas-grid">

        <div class="task-card">
            <h4>Progreso General</h4>
            <canvas id="graficoCircular"></canvas>
        </div>

        <div class="task-card">
            <h4>Distribuci칩n de tareas</h4>
            <canvas id="graficoBarras"></canvas>
        </div>

    </div>

</main>

<!-- JS -->
<script>
    Chart.defaults.font.family = "-apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif";
    Chart.defaults.color = '#8e8e93';

    // Datos desde Flask
    const total = {{ total }};
    const completadas = {{ completadas }};
    const pendientes = {{ pendientes }};

    // Gr치fico circular
    new Chart(document.getElementById('graficoCircular'), {
        type: 'doughnut',
        data: {
            labels: ['Completadas', 'Pendientes'],
            datasets: [{
                data: [completadas, pendientes],
                backgroundColor: ['#34c759', '#ff3b30'],
                borderWidth: 0
            }]
        },
        options: {
            cutout: '65%',
            plugins: {
                legend: {
                    position: 'bottom'
                }
            }
        }
    });

    // Gr치fico de barras
    new Chart(document.getElementById('graficoBarras'), {
        type: 'bar',
        data: {
            labels: ['Completadas', 'Pendientes'],
            datasets: [{
                label: 'Cantidad',
                data: [completadas, pendientes],
                backgroundColor: ['#34c759', '#ff3b30'],
                borderRadius: 8
            }]
        },
        options: {
            plugins: {
                legend: { display: false }
            },
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
</script>

</body>
</html>